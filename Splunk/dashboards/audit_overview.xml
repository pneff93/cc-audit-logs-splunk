<form theme="dark" version="1.1">
    <label>Confluent Cloud Audit Overview</label>
    <description>Audit logs provide a way to capture, protect, and preserve authorization activity into topics in Kafka clusters on Confluent Cloud using Confluent Server Authorizer. Specifically, audit logs record the runtime decisions of the permission checks that occur as users attempt to take actions that are protected by ACLs and RBAC. Auditable events are recorded in chronological order, although it is possible for a consumer of audit log messages to fetch them out of order. Refer to Confluent Docs for more details: https://docs.confluent.io/current/security/audit-logs/audit-log-index.html</description>
    <fieldset submitButton="false">
        <input type="time" token="time_tok">
            <label>Time</label>
            <default>
                <earliest>-60m@m</earliest>
                <latest>now</latest>
            </default>
        </input>
        <input type="dropdown" token="user_tok">
            <label>UserName</label>
            <choice value="*">All</choice>
            <default>*</default>
            <initialValue>*</initialValue>
            <fieldForLabel>user</fieldForLabel>
            <fieldForValue>user</fieldForValue>
            <search>
                <query>index=main | rename "data.authenticationInfo.principal" as user | dedup  user | table user</query>
                <earliest>-7d@h</earliest>
                <latest>now</latest>
            </search>
        </input>
    </fieldset>
    <row>
        <panel>
            <title>Total Auth Requests</title>
            <single>
                <search>
                    <query>index=main "data.authenticationInfo.principal"="$user_tok$" | timechart count span=10d BY "data.methodName"</query>
                    <earliest>$time_tok.earliest$</earliest>
                    <latest>$time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="colorBy">value</option>
                <option name="colorMode">block</option>
                <option name="drilldown">none</option>
                <option name="numberPrecision">0</option>
                <option name="rangeColors">["0x006d9c","0x0877a6","0x006d9c"]</option>
                <option name="rangeValues">[0,30]</option>
                <option name="refresh.display">progressbar</option>
                <option name="showSparkline">1</option>
                <option name="showTrendIndicator">1</option>
                <option name="trellis.enabled">0</option>
                <option name="trellis.scales.shared">1</option>
                <option name="trellis.size">large</option>
                <option name="trendColorInterpretation">standard</option>
                <option name="trendDisplayMode">absolute</option>
                <option name="unitPosition">after</option>
                <option name="useColors">1</option>
                <option name="useThousandSeparators">1</option>
            </single>
        </panel>
        <panel>
            <title>Top Users</title>
            <chart>
                <search>
                    <query>index=main "data.authenticationInfo.principal"="$user_tok$"| top limit=20 "data.authenticationInfo.principal"</query>
                    <earliest>$time_tok.earliest$</earliest>
                    <latest>$time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleX.visibility">visible</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisX.abbreviation">none</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.abbreviation">none</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.axisY2.abbreviation">none</option>
                <option name="charting.axisY2.enabled">0</option>
                <option name="charting.axisY2.scale">inherit</option>
                <option name="charting.chart">pie</option>
                <option name="charting.chart.bubbleMaximumSize">50</option>
                <option name="charting.chart.bubbleMinimumSize">10</option>
                <option name="charting.chart.bubbleSizeBy">area</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">stacked</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.mode">standard</option>
                <option name="charting.legend.placement">right</option>
                <option name="charting.lineWidth">2</option>
                <option name="refresh.display">progressbar</option>
                <option name="trellis.enabled">0</option>
                <option name="trellis.scales.shared">1</option>
                <option name="trellis.size">medium</option>
            </chart>
        </panel>
        <panel>
            <title>Management Requests</title>
            <chart>
                <search>
                    <query>index=main data.methodName!=mds.Authorize "data.authenticationInfo.principal"="$user_tok$" | stats count by data.methodName</query>
                    <earliest>$time_tok.earliest$</earliest>
                    <latest>$time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.axisTitleX.visibility">visible</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisX.scale">log</option>
                <option name="charting.axisY.scale">log</option>
                <option name="charting.chart">bar</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.legend.placement">right</option>
                <option name="refresh.display">progressbar</option>
                <option name="trellis.enabled">0</option>
                <option name="trellis.scales.shared">1</option>
                <option name="trellis.size">large</option>
            </chart>
        </panel>
    </row>
    <row>
        <panel>
            <title>Success vs Failed Authorizations</title>
            <chart>
                <search>
                    <query>index=main ("data.authenticationInfo.principal"="*" AND "data.authorizationInfo.granted"!="") "data.authenticationInfo.principal"="$user_tok$"
                        | timechart count by data.authorizationInfo.granted
                        | rename true as Sucess</query>
                    <earliest>$time_tok.earliest$</earliest>
                    <latest>$time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleX.visibility">visible</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisX.abbreviation">none</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.abbreviation">none</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.axisY2.abbreviation">none</option>
                <option name="charting.axisY2.enabled">0</option>
                <option name="charting.axisY2.scale">inherit</option>
                <option name="charting.chart">line</option>
                <option name="charting.chart.bubbleMaximumSize">50</option>
                <option name="charting.chart.bubbleMinimumSize">10</option>
                <option name="charting.chart.bubbleSizeBy">area</option>
                <option name="charting.chart.nullValueMode">zero</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">default</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.mode">standard</option>
                <option name="charting.legend.placement">right</option>
                <option name="charting.lineWidth">2</option>
                <option name="refresh.display">progressbar</option>
                <option name="trellis.enabled">0</option>
                <option name="trellis.scales.shared">1</option>
                <option name="trellis.size">medium</option>
                <option name="trellis.splitBy">data.authorizationInfo.granted</option>
            </chart>
        </panel>
        <panel>
            <title>User Authorizations</title>
            <table>
                <search>
                    <query>index=main "data.authenticationInfo.principal"="$user_tok$"
                        | rename data.authorizationInfo.granted as granted
                        | eval granted=if(granted="false","Failed","Sucess")
                        | chart sparkline count over data.authenticationInfo.principal by granted</query>
                    <earliest>$time_tok.earliest$</earliest>
                    <latest>$time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="count">10</option>
                <option name="dataOverlayMode">none</option>
                <option name="drilldown">cell</option>
                <option name="percentagesRow">false</option>
                <option name="rowNumbers">false</option>
                <option name="totalsRow">false</option>
                <option name="wrap">true</option>
            </table>
        </panel>
    </row>
    <row>
        <panel>
            <title>Resource Usages</title>
            <chart>
                <search>
                    <query>index=main data.authorizationInfo.resourceName!=_* "data.authenticationInfo.principal"="$user_tok$" | rename data.authorizationInfo.resourceName as resourceName  | timechart count by resourceName</query>
                    <earliest>$time_tok.earliest$</earliest>
                    <latest>$time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleX.visibility">visible</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisX.abbreviation">none</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.abbreviation">none</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.axisY2.abbreviation">none</option>
                <option name="charting.axisY2.enabled">0</option>
                <option name="charting.axisY2.scale">inherit</option>
                <option name="charting.chart">area</option>
                <option name="charting.chart.bubbleMaximumSize">50</option>
                <option name="charting.chart.bubbleMinimumSize">10</option>
                <option name="charting.chart.bubbleSizeBy">area</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">stacked</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.mode">standard</option>
                <option name="charting.legend.placement">right</option>
                <option name="charting.lineWidth">2</option>
                <option name="height">347</option>
                <option name="refresh.display">progressbar</option>
                <option name="trellis.enabled">0</option>
                <option name="trellis.scales.shared">1</option>
                <option name="trellis.size">medium</option>
            </chart>
        </panel>
        <panel>
            <title>Kafka Client Requests</title>
            <table>
                <search>
                    <query>index=main "data.authenticationInfo.principal"="$user_tok$" data.request.client_id!=_*
                        | rename data.request.client_id as client_id
                        | stats sparkline count by client_id
                        | sort - count</query>
                    <earliest>$time_tok.earliest$</earliest>
                    <latest>$time_tok.latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="count">10</option>
                <option name="dataOverlayMode">none</option>
                <option name="drilldown">cell</option>
                <option name="percentagesRow">false</option>
                <option name="refresh.display">progressbar</option>
                <option name="rowNumbers">false</option>
                <option name="totalsRow">false</option>
                <option name="wrap">true</option>
            </table>
        </panel>
    </row>
</form>